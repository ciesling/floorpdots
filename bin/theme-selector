#!/usr/bin/env bash
# rofi theme selector
# https://github.com/cherrynoize/dotfiles
# Author:= cherrynoize
# Thanks:= https://github.com/gh0stzk/dotfiles

rofi_cmd="rofi -dmenu -i -theme ~/.config/rofi/theme-selector/theme-selector.rasi"
current_theme="$(theme show)"

mapfile -t themes < <(theme list)

rofi_win () {
  printf "%s\n" "${options[@]}" |
    $rofi_cmd -selected-row "${selected_index:-0}"
}

declare -A theme_map

# list themes
for theme in "${themes[@]}"; do
  theme_name="$(theme name "$theme")"
  theme_map[$theme_name]="$theme"

  options+=("$theme_name")

  # select current theme by index
  if [ "$current_theme" = "$theme" ]; then
      selected_index="$index"
  fi

  (( index++ ))
done

# launch rofi menu and store result
selected="$(rofi_win)"

[ -n "$selected" ] || exit 1
theme -n set "${theme_map[$selected]}"
