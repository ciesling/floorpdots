#!/usr/bin/env bash
# sync local changes with remote
# author | cherrynoize

repo_file="$HOME/.repos"

msg="auto sync (sync-system: $(date "+%Y-%m-%d %H:%M"))"
sep="===================="

# read and store repos into array
# (ignore lines starting with a #)
mapfile -t repos <<< "$(sed 's/^#.*//' "$repo_file")"

# sync dotfiles
echo "$sep"
echo "syncing dotfiles ..."
# fetch latest config
cfg pull
# push local changes
update-config "$msg" &

# sync for each repo
for r in "${repos[@]}"; do
  r="$(eval echo "$r")" # expand variables inside r
  if [ -n "$r" ]; then
    echo "$sep"
    echo "syncing $r ..."
    sync-repo "$r" "$msg" || exit 1
  fi
done

echo "$sep"
echo done.
